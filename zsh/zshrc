#
# :Author: Sorin Ionescu <sorin.ionescu@gmail.com>
# :customized: PB
# Last modified: <Thu 04 Oct 2018 05:31:02 PM PDT>
#
# Executes commands at the start of an interactive session.

# Make sure the shell is interactive
case $- in
    *i*) ;;
    *) return ;;
esac
#
# Source Prezto.
# if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
#  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
# fi

# ---PB additions below-----
# init fasd on eleanor; fasd is part of pretzo on petunia
case $HOST in
  (petunia) SED="gsed" ;;
  (eleanor)
    eval "$(fasd --init auto)"
    SED="sed"
    ;;
  (*) eval "$(fasd --init auto)"
    SED="sed"
    ;;
esac

# colors
export TERM=xterm-256color
export ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=22'

# ---paths-----
# this starts with the output of /usr/libexec/path_helper
PATH="/usr/local/sbin:$PATH"
PATH="$HOME/anaconda3/bin:$PATH"
PATH+=":$HOME/bin"
PATH+=":/Applications/RStudio.app/Contents/MacOS/pandoc"
PATH+=":$HOME/projects/hrdag/snap/bin"
PATH+=":$HOME/.cargo/bin"
export PATH
fpath=( "$HOME/dotfiles/zsh/zfunctions" $fpath )

# ---shell options-----
setopt AUTO_PUSHD
setopt PUSHD_IGNORE_DUPS
setopt CHASE_LINKS
setopt ALWAYS_TO_END
setopt rm_star_silent
setopt HIST_IGNORE_DUPS
setopt BANG_HIST
setopt EXTENDED_HISTORY
setopt APPEND_HISTORY
setopt appendhistory     #Append history to the history file (no overwriting)
setopt sharehistory      #Share history across terminals
setopt INC_APPEND_HISTORY
setopt incappendhistory  #Immediately append to the history file, not just when a term is killed

HISTSIZE=10000               #How many lines of history to keep in memory
HISTFILE=~/.zsh_history     #Where to save history to disk
SAVEHIST=10000               #Number of history entries to save to disk
HISTDUP=erase               #Erase duplicates in the history file

# setting up fzf keybindings
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# ---aliases-----
alias gs="git status"
# alias gl="git log --graph --pretty=oneline --abbrev-commit"
# alias gl='git log --pretty=format:"%h%x09%an%x09%ad%x09%s"'
alias gl="$HOME/bin/git-log-compact"
alias gd="git diff"
alias gdc="git diff --cached"

alias mm="make -f src/Makefile"
alias nm="nvim src/Makefile"
alias ccat="pygmentize $1"

# unalias rm

# List all files colorized in long format
# Detect which `ls` flavor is in use
if ls --color > /dev/null 2>&1; then # GNU `ls`
	colorflag="--color"
else # OS X `ls`
	colorflag="-G"
fi
alias ll="ls -ltrF ${colorflag}"
# List all files colorized in long format, including dot files
alias la="ls -laF ${colorflag}"
# List only directories
alias lsd="ls -lF ${colorflag} | grep --color=never '^d'"

# overriding alias=j in zprezto's fasd module: use fzf, don't print scores
alias j='xdir=$(fasd -ld | fzf --tac) && cd "$xdir"'

# use fzf for history search
alias h='print -z $(fc -l 1 | fzf +s --tac | $SED -re "s/^\s*[0-9]+\s*//")'

# ---env vars-----
export EDITOR='vim'
export LANG='en_US.UTF-8';
export LC_ALL='en_US.UTF-8';

# ---for zsh-----
export KEYTIMEOUT=1
bindkey -e
bindkey '^?' backward-delete-char
bindkey '^P' up-history
bindkey '^N' down-history
bindkey '^?' backward-delete-char
bindkey '^h' backward-delete-char
bindkey '^w' backward-kill-word
bindkey '^r' history-incremental-search-backward
bindkey '^ ' autosuggest-accept

autoload -U zmv
autoload -U promptinit; promptinit


# ---local-----
export HOMEBREW_GITHUB_API_TOKEN="7105df98ca887eda6aa4125926a86945b5da40bd"

export LOCALGIT="/Users/pball/projects"
export HRDAGGIT="$LOCALGIT/hrdag"
export PERSONALGIT="$LOCALGIT/personal"

export PURE_ALWAYS_SHOW_USER=1

# optionally define custom generators
prompt_custom() {
	preprompt+=( custom )
}

prompt pure

# add the generator where it's needed
prompt_pure_pieces=(
  prompt_pure_render_hostname
  prompt_pure_render_path
  prompt_pure_render_vcs
  prompt_pure_render_exec_time
)
# prompt_pure_pieces=(
# 	${prompt_pure_pieces:0:2}
# 	prompt_custom
# 	${prompt_pure_pieces:2}
#   )

# done.

